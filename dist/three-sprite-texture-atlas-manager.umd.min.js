function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.threeSpriteAtlasTextureManager=e()}(this,function(){"use strict";var t=function(){function t(e,i,n,r){_classCallCheck(this,t),this.left=Math.floor("number"==typeof e&&isFinite(e)?e:0),this.top=Math.floor("number"==typeof i&&isFinite(i)?i:0),this.right=Math.floor("number"==typeof n&&isFinite(n)?n:0),this.bottom=Math.floor("number"==typeof r&&isFinite(r)?r:0)}return _createClass(t,[{key:"Xcentre",get:function(){return Math.floor((this.right-this.left)/2+this.left)-.5}},{key:"Ycentre",get:function(){return Math.floor((this.bottom-this.top)/2+this.top)-.5}},{key:"width",get:function(){return this.right-this.left}},{key:"height",get:function(){return this.bottom-this.top}}]),t}(),e=function(){function e(i){_classCallCheck(this,e),this.knapsack=i,this.leftChild=null,this.rightChild=null,this.rectangle=null,this.rectangle=new t(0,0,i.textureSize,i.textureSize),this.imageID=null,this._texture=null}return _createClass(e,[{key:"hasChildren",value:function(){return null!==this.leftChild||null!==this.rightChild}},{key:"isOccupied",value:function(){return null!==this.imageID}},{key:"uvCoordinates",value:function(){var t=this.knapsack.textureSize;return[this.rectangle.left/t,1-this.rectangle.bottom/t,this.rectangle.right/t,1-this.rectangle.top/t]}},{key:"release",value:function(){if(this.hasChildren())throw new Error("Can not release tree node, still has children");null!==this._texture&&(this._texture.dispose(),this._texture=null),this.clear(),this.imageID=null}},{key:"clear",value:function(){this.context.clearRect(this.rectangle.left,this.rectangle.top,this.width-1,this.height-1)}},{key:"clipContext",value:function(){var t=this.context;return t.save(),t.beginPath(),t.rect(this.rectangle.left+1,this.rectangle.top+1,this.width-2,this.height-2),t.clip(),t.translate(this.rectangle.Xcentre,this.rectangle.Ycentre),t}},{key:"restoreContext",value:function(){this.context.restore()}},{key:"allocate",value:function(i,n){if(this.hasChildren()){var r=this.leftChild.allocate(i,n);return r instanceof e?(r.claim(),r):this.rightChild.allocate(i,n)}if(this.isOccupied())return null;if(i>this.width||n>this.height)return null;if(i===this.width&&n===this.height)return this.claim(),this;this.leftChild=new e(this.knapsack),this.rightChild=new e(this.knapsack);var h=this.width-i,s=this.height-n;if(h>s?(this.leftChild.rectangle=new t(this.rectangle.left,this.rectangle.top,this.rectangle.left+i,this.rectangle.bottom),this.rightChild.rectangle=new t(this.rectangle.left+i,this.rectangle.top,this.rectangle.right,this.rectangle.bottom)):(this.leftChild.rectangle=new t(this.rectangle.left,this.rectangle.top,this.rectangle.right,this.rectangle.top+n),this.rightChild.rectangle=new t(this.rectangle.left,this.rectangle.top+n,this.rectangle.right,this.rectangle.bottom)),this.knapsack.textureManager.debug){var a=this.context;a.lineWidth=4,a.strokeStyle="rgba(255,0,0,1)",a.strokeRect(this.leftChild.rectangle.left,this.leftChild.rectangle.top,this.leftChild.width,this.leftChild.height),a.lineWidth=4,a.strokeStyle="rgba(0,255,0,1)",a.strokeRect(this.rightChild.rectangle.left,this.rightChild.rectangle.top,this.rightChild.width,this.rightChild.height)}return this.leftChild.allocate(i,n)}},{key:"claim",value:function(){if(this.imageID=THREE.Math.generateUUID(),this.knapsack.textureManager.debug){var t=this.context;t.lineWidth=2,t.strokeStyle="rgba( 0, 0, 255, 1 )",t.strokeRect(this.rectangle.left+.5,this.rectangle.top+.5,this.width-1,this.height-1)}}},{key:"canvas",get:function(){return this.knapsack.canvas}},{key:"context",get:function(){return this.knapsack.canvas.getContext("2d")}},{key:"width",get:function(){return this.rectangle.width}},{key:"height",get:function(){return this.rectangle.height}},{key:"texture",get:function(){if(!this._texture){this._texture=this.knapsack.rootTexture.clone(),this._texture.uuid=this.knapsack.rootTexture.uuid;var t=this.uvCoordinates();this.texture.offset.x=t[0],this.texture.offset.y=t[1],this.texture.repeat.x=t[2]-t[0],this.texture.repeat.y=t[3]-t[1]}return this._texture}}]),e}(),i=function(){function t(i,n){_classCallCheck(this,t),this.textureManager=i,this.textureSize=n,this.textureLoaded=!1,this.rootNode=new e(this),this._rootTexture=null,this._canvas=null}return _createClass(t,[{key:"allocateNode",value:function(t,e){return this.rootNode.allocate(t,e)}},{key:"canvas",get:function(){return this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.textureSize,this._canvas.height=this.textureSize),this._canvas}},{key:"rootTexture",get:function(){return this._rootTexture||(this._rootTexture=new THREE.Texture(this.canvas,THREE.UVMapping)),this._rootTexture}}]),t}(),n=function(){function t(e){_classCallCheck(this,t),this.size="number"==typeof e&&/^(128|256|512|1024|2048|4096|8192|16384)$/.test(e)?e:1024,this.knapsacks=[],this.debug=!1}return _createClass(t,[{key:"_addKnapsack",value:function(t){var e=new i(this,t);return this.knapsacks.push(e),this.debug&&console.log("TextureManager: allocated "+this.textureSize+"px texture map #"+this.knapsacks.length),e}},{key:"allocateNode",value:function(t,e){var i=this;return new Promise(function(n,r){var h=void 0;if(t>i.textureSize)return void r(Error("A width of "+t+" is too large for these textures"));if(e>i.textureSize)return void r(Error("A height of "+e+" is too large for these textures"));if(i.knapsacks.length||i._addKnapsack(i.size),i.knapsacks.forEach(function(i){(null===h||void 0===h)&&(h=i.allocateNode(t,e))}),null===h&&t<=i.textureSize){var s=i._addKnapsack(i.textureSize);h=s.allocateNode(t,e)}n(h)})}},{key:"release",value:function(t){t&&t.release()}},{key:"textureSize",get:function(){return this.size}}]),t}();return n});
//# sourceMappingURL=three-sprite-texture-atlas-manager.umd.min.js.map
